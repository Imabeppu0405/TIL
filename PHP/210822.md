# PHPによるDBの操作

## 取得＆更新

```php
$user = 'test_user';
$pwd = 'pwd';
$host = 'localhost';
$dbName = 'test_phpdb';
$dsn = "mysql:host={$host};port=8889;dbname={$dbName};";
$conn = new PDO($dsn, $user, $pwd);
//　DB操作の設定

$pst = $conn->query('select * from mst_shops');
// 値の取得

$result1 = $pst->fetchAll(PDO::FETCH_ASSOC);
//連想配列で取得した値を表示

$result2 = $conn->exec('update mst_prefs set name = "福島" where id = 5');
// 値の更新


echo '<pre>';
print_r($result1);
// 連想配列で値の表示
echo '<pre>';

print_r($result2);
// 更新で影響を受けた列の数を表示

$conn = null;
// 通信を切断（PDOの場合はなくてもOK)
```

取得にはquery,更新にはexecを用いる。

```php

function throwException() {
    try {

        $bool = false;
        $bool->method();
        // Error

        new PDO('', '', '');
        // PDOException
        
        echo '通常処理が最後まで実行されました。<br>';
    
    } catch(PDOExeption $e) {
    // PDO関連の例外はこちらで処理
        echo 'PDOException<br>';
        echo '例外処理が実行されました。<br>';
        echo $e->getMessage() . '<br>';

        echo get_class($e) . '<br>';
        //エラーの種類を表示
    }
}

try {
    
    throwException();
    
    echo '通常処理が最後まで実行されました。<br>';

} catch(Error $e) {
  //その他のエラーはこちらで処理
    echo '例外処理が実行されました。<br>';
    echo $e->getMessage() . '<br>';
    //エラーの種類を表示

} finally {

    echo '終了処理が実行されました。<br>';

}
```

tryの中でエラーが発生した場合にはcatchに飛ぶ。finallyは例外関係なく最後に実行。

```php
```

```php
```

```php
```

```php
```